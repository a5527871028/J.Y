<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>九翊美學 × J.Y Beauty Studio - 線上小卡</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 Lucide Icons (用於社群和管理員圖示) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* 設定 Inter 字體 */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            /* 暖色背景，帶有微小的聖誕氛圍 */
            background-color: #ffeaea; /* Light warm pink/red */
            background-image: radial-gradient(circle at 100% 100%, #ffdfdf, #ffeaea 50%);
            min-height: 100vh;
        }

        /* 主容器樣式 */
        #app-container {
            border: 4px solid #b91c1c; /* Deep red border */
        }
        
        /* 隱藏原生單選按鈕 (用於分頁切換) */
        .tab-input {
            display: none;
        }

        /* 根據選中的單選按鈕顯示對應的內容 */
        .tab-content {
            display: none;
        }

        /* 選中的標籤樣式 */
        .tab-input:checked + .tab-label {
            background-color: #b91c1c; /* Deep Red */
            color: #fff; /* White Text */
            border-bottom: 2px solid #fcd34d; /* Gold line */
        }

        /* 內容區塊在選中時顯示 */
        #tab-rules:checked ~ .content-rules,
        #tab-price:checked ~ .content-price,
        #tab-qa:checked ~ .content-qa,
        #tab-promo:checked ~ .content-promo,
        #tab-form:checked ~ .content-form,
        #tab-admin:checked ~ .content-admin {
            display: block;
        }

        /* 管理員介面專屬標籤，只有登入後顯示 */
        .admin-tab-item {
            display: none;
        }
        .is-admin .admin-tab-item {
            display: block;
        }

        /* Q&A 區塊的排版 */
        .qa-block {
            margin-bottom: 1.5rem;
            padding-left: 1rem;
            border-left: 4px solid #f97316; /* Orange border */
        }
        .qa-q {
            font-weight: 600;
            color: #b91c1c; /* Deep Red for Question */
            margin-bottom: 0.25rem;
        }
        .qa-a {
            color: #4a4a4a;
            font-style: italic;
        }

        /* 自定義按鈕樣式 */
        .social-btn {
            background-color: #1e3a8a; /* Dark Blue for contrast/IG */
        }
        .social-btn:hover {
            background-color: #1d4ed8;
        }
    </style>
</head>
<body class="py-6 md:py-12 flex justify-center">

    <!-- Admin Login Modal -->
    <div id="login-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm">
            <h3 class="text-xl font-bold text-red-800 mb-4">管理員登入</h3>
            <div id="login-message" class="text-sm text-red-500 mb-3 hidden"></div>
            <form id="login-form" autocomplete="off">
                <div class="mb-3">
                    <label for="admin-user" class="block text-sm font-medium text-gray-700">帳號</label>
                    <input type="text" id="admin-user" name="admin-user" required autocomplete="off"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                <div class="mb-5">
                    <label for="admin-pass" class="block text-sm font-medium text-gray-700">密碼</label>
                    <input type="password" id="admin-pass" name="admin-pass" required autocomplete="new-password"
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                <div class="flex justify-end space-x-3">
                    <button type="button" id="login-cancel" class="px-4 py-2 text-sm font-medium text-gray-700 rounded-md hover:bg-gray-100 transition">
                        取消
                    </button>
                    <button type="submit" id="login-submit" class="px-4 py-2 text-sm font-medium bg-red-600 text-white rounded-md hover:bg-red-700 transition">
                        登入
                    </button>
                </div>
            </form>
        </div>
    </div>
    <!-- End Admin Login Modal -->

    <!-- Main App Container -->
    <div id="app-container" class="w-full max-w-4xl bg-white shadow-2xl rounded-2xl p-0 overflow-hidden">
        
        <!-- Header & Social Links -->
        <header class="p-6 bg-red-800 text-white rounded-t-[14px]">
            <div class="flex justify-between items-center mb-3">
                <h1 class="text-3xl md:text-4xl font-black tracking-wider">九翊美學 × J.Y Beauty Studio</h1>
                
                <!-- Admin Login Button -->
                <button id="admin-login-btn" class="flex items-center space-x-2 text-sm font-medium bg-red-600 hover:bg-red-700 p-2 rounded-full transition shadow-md">
                    <i data-lucide="bell" class="w-5 h-5"></i>
                </button>
            </div>

            <!-- Social Links & Location -->
            <div class="flex items-center space-x-3 mb-3">
                <!-- Instagram Link -->
                <a href="https://www.instagram.com/jystudio_1210?igsh=MWQ3czM4bHRqd2FmZw==" target="_blank"
                   class="social-btn px-3 py-1 flex items-center space-x-1 rounded-full text-sm font-semibold text-white transition duration-200">
                    <i data-lucide="instagram" class="w-4 h-4"></i>
                    <span>IG</span>
                </a>
                <!-- LINE Link -->
                <a href="https://lin.ee/gRA18AK" target="_blank"
                   class="social-btn px-3 py-1 flex items-center space-x-1 rounded-full text-sm font-semibold text-white transition duration-200"
                   style="background-color: #00B900;">
                    <!-- Line Logo - Using a simple icon approximation -->
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="w-4 h-4 fill-current">
                        <path d="M472.9 59.8c-2.3-2.3-5.2-3.4-8.5-3.4H47.6c-3.3 0-6.2 1.1-8.5 3.4-2.3 2.3-3.4 5.2-3.4 8.5v381.4c0 3.3 1.1 6.2 3.4 8.5 2.3 2.3 5.2 3.4 8.5 3.4h375.4l49.9 49.9V68.3c0-3.3-1.1-6.2-3.4-8.5zM227.4 353.5c-4.4 0-8.2-1.5-11.4-4.5-3.2-3-4.8-6.9-4.8-11.5v-80.4c0-4.6 1.6-8.5 4.8-11.5 3.2-3 7-4.5 11.4-4.5h57.4c4.4 0 8.2 1.5 11.4 4.5 3.2 3 4.8 6.9 4.8 11.5v80.4c0 4.6-1.6 8.5-4.8 11.5-3.2 3-7 4.5-11.4 4.5h-57.4zm10.5-177.3c-28.7 0-53.8 10-75.3 30.1-21.6 20.1-32.4 44.8-32.4 74v80.4c0 14.3 2.5 27 7.5 38.3 5 11.3 11.7 20.1 20.2 26.5 8.5 6.4 18.4 9.6 29.8 9.6h57.4c11.3 0 21.2-3.2 29.7-9.6 8.5-6.4 15.2-15.2 20.2-26.5 5-11.3 7.5-24 7.5-38.3v-80.4c0-29.2-10.8-54-32.4-74-21.5-20.1-46.6-30.1-75.3-30.1z"/>
                    </svg>
                    <span>LINE</span>
                </a>
            </div>

            <p class="text-sm font-light text-yellow-300">📍 台南 永康區</p>
        </header>

        <!-- Error/Message Display -->
        <div id="app-message" class="hidden mx-6 mt-4 p-3 text-sm rounded-lg" role="alert"></div>


        <!-- Tabs Navigation -->
        <div id="tabs-container" class="w-full border-b border-gray-200">
            <div class="flex flex-wrap text-sm font-medium text-center text-gray-500">
                
                <!-- Tab 1: 預約須知 -->
                <input type="radio" name="tab-group" id="tab-rules" class="tab-input" checked>
                <label for="tab-rules" class="tab-label p-3 md:p-4 inline-block cursor-pointer hover:bg-red-50 transition duration-150 rounded-tl-xl text-red-800">預約須知</label>
                
                <!-- Tab 2: 價目表 -->
                <input type="radio" name="tab-group" id="tab-price" class="tab-input">
                <label for="tab-price" class="tab-label p-3 md:p-4 inline-block cursor-pointer hover:bg-red-50 transition duration-150 text-red-800">價目表</label>
                
                <!-- Tab 3: Q&A -->
                <input type="radio" name="tab-group" id="tab-qa" class="tab-input">
                <label for="tab-qa" class="tab-label p-3 md:p-4 inline-block cursor-pointer hover:bg-red-50 transition duration-150 text-red-800">Q&A</label>

                <!-- Tab 4: 本月活動 -->
                <input type="radio" name="tab-group" id="tab-promo" class="tab-input">
                <label for="tab-promo" class="tab-label p-3 md:p-4 inline-block cursor-pointer hover:bg-red-50 transition duration-150 text-red-800">本月活動</label>
                
                <!-- Tab 5: 預約表單 -->
                <input type="radio" name="tab-group" id="tab-form" class="tab-input">
                <label for="tab-form" class="tab-label p-3 md:p-4 inline-block cursor-pointer hover:bg-red-50 transition duration-150 text-red-800">預約表單</label>

                <!-- Tab 6: 管理員專屬 - 預約時刻表 -->
                <input type="radio" name="tab-group" id="tab-admin" class="tab-input">
                <label for="tab-admin" class="admin-tab-item tab-label p-3 md:p-4 inline-block cursor-pointer hover:bg-red-50 transition duration-150 text-yellow-300 bg-red-900 border-l border-red-700">管理員：預約時刻表</label>
            </div>
        </div>

        <!-- Tabs Content -->
        <div id="content-area" class="p-6 md:p-8">

            <!-- Content 1: 預約須知 (可編輯) -->
            <div class="tab-content content-rules">
                <h2 class="text-2xl font-bold text-red-700 mb-4 border-b pb-2">預約須知</h2>
                <div id="rules-content" class="space-y-6 text-gray-700">
                    <div id="rules-display">載入中...</div>
                    <div id="rules-edit" class="space-y-4 hidden border p-4 rounded-lg bg-gray-50">
                        <h3 class="font-bold text-lg text-red-800">編輯 店內規則</h3>
                        <textarea id="rules-text-edit" rows="10" class="w-full p-2 border rounded resize-y"></textarea>
                        <h3 class="font-bold text-lg text-red-800">編輯 施作前注意</h3>
                        <textarea id="cautions-text-edit" rows="10" class="w-full p-2 border rounded resize-y"></textarea>
                        <button id="save-rules-btn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150">儲存變更</button>
                    </div>
                </div>
            </div>

            <!-- Content 2: 價目表 -->
            <div class="tab-content content-price">
                <h2 class="text-2xl font-bold text-red-700 mb-6 border-b pb-2">價目表</h2>
                <div class="space-y-8">
                    <!-- 熱蠟除毛 -->
                    <div class="p-4 rounded-xl bg-yellow-50 border border-yellow-200 shadow-md">
                        <h3 class="text-xl font-extrabold text-red-600 mb-2">熱蠟除毛</h3>
                        <p class="text-sm italic text-gray-600 mb-4">使用 italwax 義朵熱蠟</p>
                        
                        <!-- 價格表模板 -->
                        <div id="price-list-container" class="space-y-6">
                            <!-- Private Area -->
                            <div class="border-t pt-4 border-yellow-300">
                                <h4 class="font-bold text-lg text-red-800 mb-2 flex items-center"><i data-lucide="heart" class="w-4 h-4 mr-2 fill-red-400 text-red-400"></i> 私密處</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left text-sm whitespace-nowrap">
                                        <thead>
                                            <tr class="bg-red-100 text-red-800">
                                                <th class="px-4 py-2">項目</th>
                                                <th class="px-4 py-2">原價</th>
                                                <th class="px-4 py-2 text-orange-500">開幕價</th>
                                                <th class="px-4 py-2 text-green-600">學生價</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-b">
                                                <td class="px-4 py-2">比基尼除毛</td><td>1000</td><td class="text-orange-500 font-semibold">899</td><td class="text-green-600 font-semibold">799</td>
                                            </tr>
                                            <tr>
                                                <td class="px-4 py-2">巴西式全除</td><td>1500</td><td class="text-orange-500 font-semibold">1299</td><td class="text-green-600 font-semibold">999</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Arms -->
                            <div class="border-t pt-4 border-yellow-300">
                                <h4 class="font-bold text-lg text-red-800 mb-2 flex items-center"><i data-lucide="armchair" class="w-4 h-4 mr-2"></i> 手部</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left text-sm whitespace-nowrap">
                                        <thead>
                                            <tr class="bg-red-100 text-red-800">
                                                <th class="px-4 py-2">項目</th>
                                                <th class="px-4 py-2">原價</th>
                                                <th class="px-4 py-2 text-orange-500">開幕價</th>
                                                <th class="px-4 py-2 text-green-600">學生價</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-b"><td>腋下</td><td>600</td><td class="text-orange-500 font-semibold">499</td><td class="text-green-600 font-semibold">399</td></tr>
                                            <tr class="border-b"><td>上/下手臂</td><td>800</td><td class="text-orange-500 font-semibold">699</td><td class="text-green-600 font-semibold">499</td></tr>
                                            <tr class="border-b"><td>全手臂</td><td>1200</td><td class="text-orange-500 font-semibold">1099</td><td class="text-green-600 font-semibold">899</td></tr>
                                            <tr><td>手指</td><td>400</td><td class="text-orange-500 font-semibold">299</td><td class="text-green-600 font-semibold">199</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Legs -->
                            <div class="border-t pt-4 border-yellow-300">
                                <h4 class="font-bold text-lg text-red-800 mb-2 flex items-center"><i data-lucide="footprints" class="w-4 h-4 mr-2"></i> 腿部</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left text-sm whitespace-nowrap">
                                        <thead>
                                            <tr class="bg-red-100 text-red-800">
                                                <th class="px-4 py-2">項目</th>
                                                <th class="px-4 py-2">原價</th>
                                                <th class="px-4 py-2 text-orange-500">開幕價</th>
                                                <th class="px-4 py-2 text-green-600">學生價</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-b"><td>小腿</td><td>1000</td><td class="text-orange-500 font-semibold">899</td><td class="text-green-600 font-semibold">699</td></tr>
                                            <tr class="border-b"><td>大腿</td><td>1200</td><td class="text-orange-500 font-semibold">1099</td><td class="text-green-600 font-semibold">799</td></tr>
                                            <tr class="border-b"><td>全腿</td><td>1600</td><td class="text-orange-500 font-semibold">1399</td><td class="text-green-600 font-semibold">1099</td></tr>
                                            <tr><td>膝蓋</td><td>400</td><td class="text-orange-500 font-semibold">199</td><td class="text-green-600 font-semibold">150</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Other -->
                            <div class="border-t pt-4 border-yellow-300">
                                <h4 class="font-bold text-lg text-red-800 mb-2 flex items-center"><i data-lucide="tag" class="w-4 h-4 mr-2"></i> 其他部位</h4>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-left text-sm whitespace-nowrap">
                                        <thead>
                                            <tr class="bg-red-100 text-red-800">
                                                <th class="px-4 py-2">項目</th>
                                                <th class="px-4 py-2">原價</th>
                                                <th class="px-4 py-2 text-orange-500">開幕價</th>
                                                <th class="px-4 py-2 text-green-600">學生價</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="border-b"><td>肚子</td><td>1300</td><td class="text-orange-500 font-semibold">1099</td><td class="text-green-600 font-semibold">799</td></tr>
                                            <tr class="border-b"><td>上/下背</td><td>900</td><td class="text-orange-500 font-semibold">699</td><td class="text-green-600 font-semibold">599</td></tr>
                                            <tr><td>全背</td><td>1400</td><td class="text-orange-500 font-semibold">1099</td><td class="text-green-600 font-semibold">899</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- 價格備註 -->
                        <div class="mt-6 p-3 bg-red-100 border border-red-300 rounded-lg text-sm text-red-700 space-y-2">
                            <p class="font-semibold flex items-start"><i data-lucide="star" class="w-4 h-4 mr-2 mt-1 flex-shrink-0"></i> 上述開幕價只限開幕體驗月有而已，活動結束恢復原價</p>
                            <p class="font-semibold flex items-start"><i data-lucide="star" class="w-4 h-4 mr-2 mt-1 flex-shrink-0"></i> 開幕價及學生價都符合資格擇一參加</p>
                            <p class="font-semibold flex items-start"><i data-lucide="star" class="w-4 h-4 mr-2 mt-1 flex-shrink-0"></i> 學生出示實體卡並加入官方LINE方可享學生價優惠，可參加開幕月折上折活動</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content 3: Q&A -->
            <div class="tab-content content-qa">
                <h2 class="text-2xl font-bold text-red-700 mb-4 border-b pb-2">常見問答 Q&A</h2>
                <div class="space-y-6">
                    <h3 class="text-xl font-bold text-red-600 border-b-2 border-red-300 pb-1">活動相關</h3>
                    <div class="qa-block">
                        <p class="qa-q">Q: 開幕月期間為何時？</p>
                        <p class="qa-a">A: 整個12月都是喔！</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 折上折活動是什麼意思？</p>
                        <p class="qa-a">A: 開幕月只要你有優惠卷或符合任一資格折扣，且單筆消費金額滿五百以上，都可以併行使用。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 活動好多我有點混亂。</p>
                        <p class="qa-a">A: 可以參考右上方「本月活動」頁面資訊，有這個月活動詳述。</p>
                    </div>

                    <h3 class="text-xl font-bold text-red-600 border-b-2 border-red-300 pb-1 pt-4">預約相關</h3>
                    <div class="qa-block">
                        <p class="qa-q">Q: 半預約制什麼意思？你們營業24小時嗎？</p>
                        <p class="qa-a">A: 希望你們提前約，但在日間時段 (10:00~17:00) 可以致電詢問當天還有沒有時間段，如果有還是可以前來施作；夜間時段 (18:00~03:00) 至少三天前就需要約。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 我想預約，應該怎麼做？</p>
                        <p class="qa-a">A: 日間時段 (10:00~17:00) LINE 都可以預約喔。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 請問如果我來不及在預約日三天前取消怎麼辦？</p>
                        <p class="qa-a">A: 下次預約可以先私訊，完成訂金匯款就會幫你預約。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 我未到一次，再次預約又是三天內取消，是不是訂金就被吃掉了？</p>
                        <p class="qa-a">A: 是的，這樣表示未到兩次，兩個時間段都已經為您安排。</p>
                    </div>
                    
                    <h3 class="text-xl font-bold text-red-600 border-b-2 border-red-300 pb-1 pt-4">J.Y 特別加購項目：臨托服務</h3>
                    <div class="qa-block">
                        <p class="qa-q">Q: 我想除毛時，預約臨時托育服務，可以嗎？有沒有什麼限制？</p>
                        <p class="qa-a">A: 暫時不開放，之後僅開放夜間時段臨托，年齡限制 5 歲以下，且也需要看保母安排，如果可以接受請先加我們 LINE，私訊「我想加購托育」，服務人員會回覆您價格及時段。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 臨時托育服務是專業人員嗎？</p>
                        <p class="qa-a">A: 是，有永康區居家托育證照，加入準公托而且是相關科系。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 我加購臨時托育服務看得到小孩嗎？</p>
                        <p class="qa-a">A: 通常看不到，但小孩就在二樓而已，而妳在一樓施作。如果要看到可以另外事先提出。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 沒加購臨托可以帶小孩去嗎？</p>
                        <p class="qa-a">A: 沒辦法喔，因施作時環境需要安靜、也比較不能被動彈。</p>
                    </div>
                    
                    <h3 class="text-xl font-bold text-red-600 border-b-2 border-red-300 pb-1 pt-4">熱蠟相關</h3>
                    <div class="qa-block">
                        <p class="qa-q">Q: 熱蠟除毛好處？</p>
                        <p class="qa-a">A: 除毛效果依個人體質約維持三~七週，並且連根拔除過程中因破壞毛囊，長期固定回除能使毛髮變細、變少，生長速度也會變慢。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 為什麼除毛完會變白？</p>
                        <p class="qa-a">A: 因為熱蠟附帶去除老廢角質，也有體驗客因為這樣除全身熱蠟喔！(全身熱蠟需預約整天喔)</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 會不會很燙或很痛？</p>
                        <p class="qa-a">A: 本店使用 italwax 義朵熱蠟，不會很燙，之於一般熱蠟減痛非常多，但依據個人毛囊狀況會有不同痛感。</p>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 什麼情況不能做熱蠟？</p>
                        <div class="mt-2 text-sm">
                            <p class="font-medium text-red-700">禁忌症（不可預約）：</p>
                            <ul class="list-disc list-inside ml-4 text-gray-600">
                                <li>曬傷、換膚、嚴重靜脈曲張</li>
                                <li>性病及其他傳染性疾病</li>
                                <li>痘痘藥物中</li>
                                <li>12 週內或 35 週以上之孕婦</li>
                            </ul>
                            <p class="font-medium text-red-700 mt-2">須醫生同意：</p>
                            <ul class="list-disc list-inside ml-4 text-gray-600">
                                <li>糖尿病、抗生素中、免疫力失調</li>
                                <li>避孕藥/荷爾蒙治療</li>
                            </ul>
                        </div>
                    </div>
                    <div class="qa-block">
                        <p class="qa-q">Q: 術後需要特別做什麼保養嗎？</p>
                        <p class="qa-a">A: 除毛前後請勤勞密集保濕，除毛一週後去角質，有助於新毛髮及避免內崁毛狀況，請注意產品不能含酸、也沒有美白功能。</p>
                    </div>
                </div>
            </div>

            <!-- Content 4: 本月活動 (可編輯) -->
            <div class="tab-content content-promo">
                <div class="flex justify-between items-center mb-4 border-b pb-2">
                    <h2 class="text-2xl font-bold text-red-700">本月活動</h2>
                    <button id="edit-promo-btn" class="hidden text-sm font-semibold bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded transition duration-150">編輯</button>
                </div>
                
                <div id="promo-content" class="space-y-6 text-gray-700">
                    <div id="promo-display">載入中...</div>
                    <div id="promo-edit" class="space-y-4 hidden border p-4 rounded-lg bg-gray-50">
                        <textarea id="promo-text-edit" rows="15" class="w-full p-2 border rounded resize-y"></textarea>
                        <button id="save-promo-btn" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-150">儲存變更</button>
                    </div>
                </div>
            </div>

            <!-- Content 5: 預約表單 -->
            <div class="tab-content content-form">
                <h2 class="text-2xl font-bold text-red-700 mb-6 border-b pb-2">預約表單</h2>
                <div id="booking-message" class="hidden p-3 mb-4 rounded-lg text-sm"></div>

                <form id="booking-form" class="space-y-4">
                    <!-- 姓名 -->
                    <div>
                        <label for="booking-name" class="block text-sm font-medium text-gray-700">姓名</label>
                        <input type="text" id="booking-name" required
                               class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- 預約項目 -->
                    <div>
                        <label for="booking-service" class="block text-sm font-medium text-gray-700">預約項目</label>
                        <select id="booking-service" required
                                class="mt-1 block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                            <option value="" disabled selected>請選擇熱蠟除毛項目</option>
                            <optgroup label="私密處">
                                <option value="比基尼除毛">比基尼除毛</option>
                                <option value="巴西式全除">巴西式全除</option>
                            </optgroup>
                            <optgroup label="手部">
                                <option value="腋下">腋下</option>
                                <option value="上/下手臂">上/下手臂</option>
                                <option value="全手臂">全手臂</option>
                                <option value="手指">手指</option>
                            </optgroup>
                            <optgroup label="腿部">
                                <option value="小腿">小腿</option>
                                <option value="大腿">大腿</option>
                                <option value="全腿">全腿</option>
                                <option value="膝蓋">膝蓋</option>
                            </optgroup>
                            <optgroup label="其他部位">
                                <option value="肚子">肚子</option>
                                <option value="上/下背">上/下背</option>
                                <option value="全背">全背</option>
                            </optgroup>
                        </select>
                    </div>

                    <!-- 預約日期 (日曆/月曆) -->
                    <div>
                        <label for="booking-date" class="block text-sm font-medium text-gray-700 mb-2">預約日期</label>
                        <input type="date" id="booking-date" required
                               class="block w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    </div>

                    <!-- 預約時間段 (動態時段) -->
                    <div id="time-slot-container">
                        <label class="block text-sm font-medium text-gray-700 mb-2">預約時間段 (請先選定日期)</label>
                        <div id="time-slots" class="flex flex-wrap gap-2">
                            <!-- Time slots will be dynamically generated here -->
                            <p class="text-sm text-gray-500">請在上方選擇日期。</p>
                        </div>
                    </div>

                    <!-- 學生身份 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">是否為學生身份</label>
                        <div class="flex items-center space-x-4">
                            <input type="radio" id="is-student-yes" name="is-student" value="是" required><label for="is-student-yes" class="text-sm text-gray-700">是</label>
                            <input type="radio" id="is-student-no" name="is-student" value="否" checked><label for="is-student-no" class="text-sm text-gray-700">否</label>
                        </div>
                        <p id="student-tip" class="hidden text-xs mt-1 p-2 bg-yellow-100 text-yellow-800 rounded">⚠️ 當天請幫我帶學生證喔！</p>
                    </div>
                    
                    <!-- 曾經預約未到 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">是否曾經預約未到</label>
                        <div class="flex items-center space-x-4">
                            <input type="radio" id="is-noshow-yes" name="is-noshow" value="是" required><label for="is-noshow-yes" class="text-sm text-gray-700">是</label>
                            <input type="radio" id="is-noshow-no" name="is-noshow" value="否" checked><label for="is-noshow-no" class="text-sm text-gray-700">否</label>
                        </div>
                        <p id="noshow-tip" class="hidden text-xs mt-1 p-2 bg-red-100 text-red-800 rounded">⚠️ 需要聯絡 LINE 官方匯款訂金喔！</p>
                    </div>

                    <!-- 願意成為模特兒 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">是否願意成為模特兒</label>
                        <div class="flex items-center space-x-4">
                            <input type="radio" id="is-model-yes" name="is-model" value="是" required><label for="is-model-yes" class="text-sm text-gray-700">是</label>
                            <input type="radio" id="is-model-no" name="is-model" value="否" checked><label for="is-model-no" class="text-sm text-gray-700">否</label>
                        </div>
                        <p id="model-tip" class="hidden text-xs mt-1 p-2 bg-green-100 text-green-800 rounded">📸 模特兒另有超優惠價格，需配合現場拍作品集並上傳到社群喔！(不會看出是本人)</p>
                    </div>

                    <!-- 提交按鈕 -->
                    <button type="submit" id="booking-submit-btn"
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition duration-150 ease-in-out shadow-md disabled:bg-gray-400 disabled:cursor-not-allowed">
                        送出預約
                    </button>
                </form>
            </div>

            <!-- Content 6: 管理員專屬 - 預約時刻表 (Admin only) -->
            <div class="tab-content content-admin">
                <h2 class="text-2xl font-bold text-red-700 mb-4 border-b pb-2">管理員專區：預約時刻表</h2>
                <div id="admin-info" class="mb-4 hidden text-green-700 font-semibold bg-green-100 p-3 rounded-lg">您已成功登入管理員模式。</div>
                
                <div id="admin-schedule-list" class="space-y-4">
                    <p class="text-gray-500">請先登入管理員以查看預約時刻表。</p>
                </div>
            </div>

        </div>
        <!-- End Tabs Content -->

        <!-- Footer Disclaimer -->
        <footer class="p-4 text-center bg-gray-100 text-gray-500 text-xs rounded-b-[14px] border-t border-gray-200">
            本店擁有店內規則及活動之最終解釋權
        </footer>
    </div>

    <!-- Firebase 腳本 -->
    <script type="module">
        // 載入 Firebase 模組
        import { initializeApp } from "firebase/app"; 
        import { getAnalytics } from "firebase/analytics";
        import { } from 'https://www.gstatic.com/firebasejs/12.6.0/jy-beauty-booking.js'

        // --- Firebase 配置與變數 ---
        // 使用者提供的 Firebase Config
        const userFirebaseConfig = {
            apiKey: "AIzaSyCUA8l-vWhPEmhJRFvvsVw-D9SswS02Cws",
            authDomain: "jy-beauty-booking.firebaseapp.com",
            projectId: "jy-beauty-booking",
            storageBucket: "jy-beauty-booking.firebasestorage.app",
            messagingSenderId: "1002086733528",
            appId: "1:1002086733528:web:be630f3eddc7b91acea9ad",
            measurementId: "G-KTT19KK0NY"
        };
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        // 管理員資訊 (硬編碼)
        const ADMIN_USER = 'a5527871028';
        const ADMIN_PASS = 'apple5512';
        
        // 預約時間段
        const TIME_SLOTS = [
            '10:00', '12:00', '14:00', '16:00', 
            '18:00', '20:00', '22:00', '24:00'
        ];

        let app, db, auth;
        let userId = null;
        let isAuthReady = false;
        let isAdmin = false;
        let loginAttempts = 0;
        let availableSlots = {}; // 儲存可預約時段: { 'YYYY-MM-DD': ['10:00', '12:00', ...] }
        let allBookings = []; // 儲存所有預約記錄

        // Firestore 集合路徑 (使用 public 路徑讓所有使用者都能讀取 config 和 bookings)
        const CONFIG_PATH = `artifacts/${internalAppId}/public/data/studio_config`;
        const BOOKINGS_PATH = `artifacts/${internalAppId}/public/data/bookings`;

        // --- DOM 元素 ---
        const loginModal = document.getElementById('login-modal');
        const loginForm = document.getElementById('login-form');
        const loginMessage = document.getElementById('login-message');
        const adminLoginBtn = document.getElementById('admin-login-btn');
        const adminInfoEl = document.getElementById('admin-info');
        const adminScheduleListEl = document.getElementById('admin-schedule-list');
        const tabsContainerEl = document.getElementById('tabs-container');
        const appMessageEl = document.getElementById('app-message');
        const userInfoEl = document.getElementById('user-info');
        
        // Tab 1: Rules
        const rulesDisplayEl = document.getElementById('rules-display');
        const rulesEditEl = document.getElementById('rules-edit');
        const rulesTextEditEl = document.getElementById('rules-text-edit');
        const cautionsTextEditEl = document.getElementById('cautions-text-edit');
        const saveRulesBtn = document.getElementById('save-rules-btn');
        const editPromoBtn = document.getElementById('edit-promo-btn');
        
        // Tab 4: Promo
        const promoDisplayEl = document.getElementById('promo-display');
        const promoEditEl = document.getElementById('promo-edit');
        const promoTextEditEl = document.getElementById('promo-text-edit');
        const savePromoBtn = document.getElementById('save-promo-btn');
        
        // Tab 5: Booking Form
        const bookingFormEl = document.getElementById('booking-form');
        const bookingDateEl = document.getElementById('booking-date');
        const timeSlotsEl = document.getElementById('time-slots');
        const studentTipEl = document.getElementById('student-tip');
        const noshowTipEl = document.getElementById('noshow-tip');
        const modelTipEl = document.getElementById('model-tip');
        const bookingSubmitBtn = document.getElementById('booking-submit-btn');

        // --- Helper Functions ---

        /**
         * @function displayAppMessage
         * @description 顯示應用程式級別的訊息（成功/錯誤）
         */
        const displayAppMessage = (message, type = 'error') => {
            appMessageEl.textContent = message;
            appMessageEl.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
            
            if (type === 'success') {
                appMessageEl.classList.add('bg-green-100', 'text-green-700');
            } else {
                appMessageEl.classList.add('bg-red-100', 'text-red-700');
            }
            setTimeout(() => appMessageEl.classList.add('hidden'), 5000);
        };

        /**
         * @function formatDateKey
         * @description 將 Date 物件或字串格式化為 YYYY-MM-DD
         */
        const formatDateKey = (date) => {
            if (date instanceof Date) {
                return date.toISOString().split('T')[0];
            }
            return date.split('T')[0]; // For input[type="date"] string
        };

        /**
         * @function renderConfigContent
         * @description 渲染設定資料（預約須知/活動）
         */
        const renderConfigContent = (doc) => {
            if (!doc.exists()) {
                // 如果文檔不存在，則設置預設值
                if (doc.id === 'rules') {
                    setInitialRules(); // 設置預設規則
                    return;
                }
                if (doc.id === 'promo') {
                    setInitialPromo(); // 設置預設活動
                    return;
                }
                return;
            }
            
            const data = doc.data();

            if (doc.id === 'rules') {
                // 處理預約須知
                const rulesHtml = data.rulesText.split('\n').map(line => `<p class="flex items-start mb-2"><i data-lucide="check-circle" class="w-4 h-4 mr-2 mt-1 flex-shrink-0 text-red-500"></i><span>${line}</span></p>`).join('');
                const cautionsHtml = data.cautionsText.split('\n').map(line => `<p class="flex items-start mb-2"><i data-lucide="alert-triangle" class="w-4 h-4 mr-2 mt-1 flex-shrink-0 text-yellow-500"></i><span>${line}</span></p>`).join('');
                
                rulesDisplayEl.innerHTML = `
                    <div class="p-4 bg-red-50 rounded-xl border border-red-200">
                        <h3 class="text-xl font-bold text-red-800 mb-4 border-b pb-2">店內規則</h3>
                        <div class="text-sm">${rulesHtml}</div>
                    </div>
                    <div class="p-4 bg-yellow-50 rounded-xl border border-yellow-200">
                        <h3 class="text-xl font-bold text-red-800 mb-4 border-b pb-2">施作前注意</h3>
                        <div class="text-sm">${cautionsHtml}</div>
                    </div>
                `;
                rulesTextEditEl.value = data.rulesText;
                cautionsTextEditEl.value = data.cautionsText;
                lucide.createIcons();

            } else if (doc.id === 'promo') {
                // 處理本月活動
                const promoHtml = data.promoText.split('\n').map(line => `<p class="flex items-start mb-2"><i data-lucide="gift" class="w-4 h-4 mr-2 mt-1 flex-shrink-0 text-orange-500"></i><span>${line}</span></p>`).join('');
                
                promoDisplayEl.innerHTML = `
                    <div class="p-4 bg-orange-50 rounded-xl border border-orange-200">
                        <h3 class="text-xl font-bold text-red-800 mb-4 border-b pb-2">活動詳情</h3>
                        <div class="text-sm">${promoHtml}</div>
                    </div>
                `;
                promoTextEditEl.value = data.promoText;
                lucide.createIcons();
            }
        };

        /**
         * @function renderAdminSchedule
         * @description 渲染管理員預約時刻表
         */
        const renderAdminSchedule = (bookings) => {
            if (!isAdmin) return;

            allBookings = bookings;
            if (bookings.length === 0) {
                adminScheduleListEl.innerHTML = '<p class="p-4 text-center text-gray-500 bg-gray-50 rounded-lg">目前沒有任何預約記錄。</p>';
                return;
            }

            // 1. 按日期分組
            const grouped = bookings.reduce((acc, booking) => {
                const dateKey = formatDateKey(booking.date);
                if (!acc[dateKey]) {
                    acc[dateKey] = [];
                }
                acc[dateKey].push(booking);
                return acc;
            }, {});

            // 2. 渲染 HTML
            let html = '';
            const sortedDates = Object.keys(grouped).sort();

            sortedDates.forEach(dateKey => {
                const dayBookings = grouped[dateKey].sort((a, b) => a.time.localeCompare(b.time));

                html += `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4 shadow-sm">
                        <h3 class="text-lg font-bold text-red-700 border-b pb-2 mb-3">${dateKey} (星期${new Date(dateKey).getDay() === 0 ? '日' : new Date(dateKey).getDay()})</h3>
                        <ul class="space-y-3">
                `;
                dayBookings.forEach(b => {
                    html += `
                        <li class="p-3 bg-white border border-gray-100 rounded-md text-sm">
                            <p class="font-semibold text-gray-800">${b.time} - ${b.name}</p>
                            <p class="text-xs text-gray-600">
                                項目: ${b.service} | 學生: ${b.isStudent} | 未到: ${b.isNoshow} | 模特: ${b.isModel}
                            </p>
                        </li>
                    `;
                });
                html += `</ul></div>`;
            });

            adminScheduleListEl.innerHTML = html;
            updateTimeSlots(); // 更新預約表單的時段
        };

        /**
         * @function updateTimeSlots
         * @description 根據現有預約更新預約表單的時間段。
         */
        const updateTimeSlots = () => {
            const selectedDateStr = bookingDateEl.value;
            timeSlotsEl.innerHTML = '';
            
            if (!selectedDateStr) {
                timeSlotsEl.innerHTML = '<p class="text-sm text-gray-500">請在上方選擇日期。</p>';
                return;
            }

            const selectedDate = new Date(selectedDateStr);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            if (selectedDate < today) {
                timeSlotsEl.innerHTML = '<p class="text-sm text-red-500">無法預約過去的日期。</p>';
                return;
            }

            // 計算當天已預約的時段
            const bookedSlots = allBookings
                .filter(b => formatDateKey(b.date) === selectedDateStr)
                .map(b => b.time);
            
            // 生成時間段按鈕
            TIME_SLOTS.forEach(time => {
                const isBooked = bookedSlots.includes(time);
                const buttonClass = isBooked 
                    ? 'bg-gray-300 text-gray-500 cursor-not-allowed'
                    : 'bg-red-500 hover:bg-red-600 text-white cursor-pointer';
                
                timeSlotsEl.innerHTML += `
                    <label class="time-slot-label">
                        <input type="radio" name="booking-time" value="${time}" class="hidden" ${isBooked ? 'disabled' : ''} required>
                        <span class="inline-block px-3 py-1 text-sm font-semibold rounded-full transition duration-150 ${buttonClass}"
                              onclick="document.getElementById('booking-time-${time}').checked=true; document.getElementById('booking-time-${time}').click();">
                            ${time}
                        </span>
                    </label>
                `;
            });

            // 如果所有時段都滿了
            if (bookedSlots.length === TIME_SLOTS.length) {
                timeSlotsEl.innerHTML = '<p class="text-sm text-red-500 font-semibold">該日期所有時段已滿，請選擇其他日期。</p>';
            }
        };

        // --- Firebase Init & Auth ---

        /**
         * @function setupFirebase
         * @description 初始化 Firebase 應用程式並處理認證。
         */
        const setupFirebase = async () => {
            try {
                // setLogLevel('debug'); // 開啟 Firebase 偵錯日誌
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // 處理認證 (使用 Canvas 提供的 Token 或匿名登入)
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

                // 監聽認證狀態變化
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        userInfoEl.textContent = `使用者 ID: ${userId}`;
                        isAuthReady = true;
                        // 認證完成後，啟動資料監聽
                        listenForConfig();
                        listenForBookings();
                    } else {
                        userId = null;
                        userInfoEl.textContent = '使用者 ID: 未登入 (匿名)';
                        isAuthReady = true; 
                    }
                    // 確保 Lucide Icons 在內容載入後創建
                    lucide.createIcons();
                });

            } catch (e) {
                displayAppMessage(`Firebase 初始化失敗: ${e.message}`);
            }
        };
        
        // --- Firestore Listeners ---

        /**
         * @function listenForConfig
         * @description 監聽管理員可編輯的設定內容。
         */
        const listenForConfig = () => {
            if (!isAuthReady) return;
            const configRef = collection(db, CONFIG_PATH);
            
            onSnapshot(configRef, (snapshot) => {
                snapshot.forEach(doc => {
                    renderConfigContent(doc);
                });
            }, (error) => {
                displayAppMessage(`設定資料監聽失敗: ${error.message}`);
            });
        };
        
        /**
         * @function listenForBookings
         * @description 監聽預約資料。
         */
        const listenForBookings = () => {
            if (!isAuthReady) return;
            const bookingsRef = collection(db, BOOKINGS_PATH);

            // 由於 Firestore 限制，不在 onSnapshot 內使用 orderBy。
            const q = bookingsRef;

            onSnapshot(q, (snapshot) => {
                const bookings = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.date?.toDate ? data.date.toDate() : new Date(data.date);
                    // 僅保留未來的預約，但為簡單管理員展示，先保留所有
                    bookings.push({
                        id: doc.id,
                        name: data.name,
                        service: data.service,
                        date: date,
                        time: data.time,
                        isStudent: data.isStudent,
                        isNoshow: data.isNoshow,
                        isModel: data.isModel
                    });
                });

                // 在客戶端進行排序 (先按日期，再按時間)
                bookings.sort((a, b) => {
                    const dateA = formatDateKey(a.date) + a.time;
                    const dateB = formatDateKey(b.date) + b.time;
                    return dateA.localeCompare(dateB);
                });

                renderAdminSchedule(bookings);
                updateTimeSlots();
            }, (error) => {
                displayAppMessage(`預約資料監聽失敗: ${error.message}`);
            });
        };

        // --- Content Default Setters ---

        const setInitialRules = async () => {
            const defaultRulesText = `限生理女、男賓止步
日間半預約制
日間時段：10～17點；夜間時段：18～3點
預約日間不用訂金，但有未到紀錄，下次預約須先匯款訂金（為預約項目總價1/2之金額）
預約夜間皆需先付款訂金（為預約項目總價1/2之金額）
遲到15分鐘以上，未先訊息告知即視為未到，並取消預約
取消預約至少提前三天，如有匯款訂金方可全額退還
因合作空間，施作空間為布簾隔斷隔音，雖除毛師人都會在，但介意勿約
美容空間無法攜帶食物及寵物`;
            
            const defaultCautionsText = `施作日前請停用酸類產品、停止去角質至少一週，避免肌膚過敏或刺激
毛髮長度需至少 0.5 至 1 公分，請勿自行修剪，以免影響除毛效果
避開生理期前 5 天到後 3 天
若有規劃出遊，建議提前3～5天安排除毛時間，讓肌膚有足夠的時間恢復，避免在出遊前一兩天才除毛
除毛前後請勤勞密集保濕，除毛時有脫皮、泛紅、紅點屬正常現象，請注意產品不能含酸、也沒有美白功能`;

            try {
                // 嘗試寫入預設值
                await setDoc(doc(db, CONFIG_PATH, 'rules'), {
                    rulesText: defaultRulesText,
                    cautionsText: defaultCautionsText,
                    updatedAt: serverTimestamp()
                }, { merge: true });
            } catch (e) {
                console.error("無法設置預設規則:", e);
            }
        };

        const setInitialPromo = async () => {
            const defaultPromoText = `整個月都享有開幕價
學生價活動過後不會消失
分享LINE官方給好友，一起加好友兩人都能拿到優惠劵，一人最高可拿五張，每次可使用1張
追蹤IG、加LINE官方、Google評論五顆星並留言，經定額折扣完，消費總額再打九折`;
            
            try {
                // 嘗試寫入預設值
                await setDoc(doc(db, CONFIG_PATH, 'promo'), {
                    promoText: defaultPromoText,
                    updatedAt: serverTimestamp()
                }, { merge: true });
            } catch (e) {
                console.error("無法設置預設活動:", e);
            }
        };

        // --- Event Handlers ---

        // 1. Admin Login Logic
        adminLoginBtn.addEventListener('click', () => {
            if (isAdmin) {
                // 如果已登入，執行登出操作
                isAdmin = false;
                loginAttempts = 0;
                document.body.classList.remove('is-admin');
                adminInfoEl.classList.add('hidden');
                editPromoBtn.classList.add('hidden');
                saveRulesBtn.classList.add('hidden'); // 隱藏編輯和儲存按鈕
                rulesEditEl.classList.add('hidden');
                promoEditEl.classList.add('hidden');
                document.getElementById('admin-login-btn').innerHTML = '<i data-lucide="bell" class="w-5 h-5"></i>';
                displayAppMessage('已登出管理員模式。', 'success');
            } else {
                loginModal.classList.remove('hidden');
                loginModal.classList.add('flex');
            }
        });
        document.getElementById('login-cancel').addEventListener('click', () => {
            loginModal.classList.remove('flex');
            loginModal.classList.add('hidden');
            loginForm.reset();
            loginAttempts = 0; // 取消登入也重置嘗試次數
            loginMessage.classList.add('hidden');
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const user = document.getElementById('admin-user').value;
            const pass = document.getElementById('admin-pass').value;
            
            if (user === ADMIN_USER && pass === ADMIN_PASS) {
                isAdmin = true;
                loginAttempts = 0;
                loginModal.classList.remove('flex');
                loginModal.classList.add('hidden');
                document.body.classList.add('is-admin');
                adminInfoEl.classList.remove('hidden');
                editPromoBtn.classList.remove('hidden');
                document.getElementById('tab-admin').checked = true; // 切換到管理員分頁
                document.getElementById('admin-login-btn').innerHTML = '<i data-lucide="log-out" class="w-5 h-5"></i>'; // 變成登出圖示
                displayAppMessage('管理員登入成功！', 'success');
            } else {
                loginAttempts++;
                if (loginAttempts >= 3) {
                    loginMessage.textContent = '登入失敗次數過多，請稍後再試。';
                    loginModal.classList.remove('flex');
                    loginModal.classList.add('hidden');
                    loginAttempts = 0;
                } else {
                    loginMessage.textContent = '請確定帳密或與管理員聯繫';
                    loginMessage.classList.remove('hidden');
                }
            }
            loginForm.reset();
        });
        
        // 2. Admin Editing Toggles
        document.getElementById('tab-rules').addEventListener('change', () => {
            if (isAdmin) {
                // 當切換到規則分頁時，顯示儲存按鈕
                saveRulesBtn.classList.remove('hidden');
            }
        });
        document.getElementById('tab-promo').addEventListener('change', () => {
            if (isAdmin) {
                // 當切換到活動分頁時，顯示編輯按鈕
                editPromoBtn.classList.remove('hidden');
            }
        });

        // 3. Admin Save Content
        saveRulesBtn.addEventListener('click', async () => {
            if (!isAdmin) return;
            const rulesText = rulesTextEditEl.value;
            const cautionsText = cautionsTextEditEl.value;

            try {
                await updateDoc(doc(db, CONFIG_PATH, 'rules'), {
                    rulesText: rulesText,
                    cautionsText: cautionsText,
                    updatedAt: serverTimestamp()
                });
                displayAppMessage('預約須知已儲存。', 'success');
                // 切換回顯示模式
                rulesEditEl.classList.add('hidden');
            } catch (e) {
                displayAppMessage(`儲存預約須知失敗: ${e.message}`);
            }
        });
        
        // 編輯活動按鈕點擊
        editPromoBtn.addEventListener('click', () => {
            if (isAdmin) {
                promoEditEl.classList.toggle('hidden');
                editPromoBtn.textContent = promoEditEl.classList.contains('hidden') ? '編輯' : '取消編輯';
            }
        });

        savePromoBtn.addEventListener('click', async () => {
            if (!isAdmin) return;
            const promoText = promoTextEditEl.value;
            try {
                await updateDoc(doc(db, CONFIG_PATH, 'promo'), {
                    promoText: promoText,
                    updatedAt: serverTimestamp()
                });
                displayAppMessage('本月活動已儲存。', 'success');
                // 切換回顯示模式
                promoEditEl.classList.add('hidden');
                editPromoBtn.textContent = '編輯';
            } catch (e) {
                displayAppMessage(`儲存本月活動失敗: ${e.message}`);
            }
        });

        // 4. Booking Form Interactivity (Tips & Date Picker)
        document.querySelector('input[name="is-student"]').addEventListener('change', (e) => {
            studentTipEl.classList.toggle('hidden', e.target.value !== '是');
        });
        document.querySelector('input[name="is-noshow"]').addEventListener('change', (e) => {
            noshowTipEl.classList.toggle('hidden', e.target.value !== '是');
        });
        document.querySelector('input[name="is-model"]').addEventListener('change', (e) => {
            modelTipEl.classList.toggle('hidden', e.target.value !== '是');
        });
        
        // 5. Date Change (Triggers time slot update)
        bookingDateEl.addEventListener('change', updateTimeSlots);

        // 6. Booking Form Submission
        bookingFormEl.addEventListener('submit', async (e) => {
            e.preventDefault();
            bookingSubmitBtn.disabled = true;
            const originalText = bookingSubmitBtn.textContent;
            bookingSubmitBtn.textContent = "送出中...";

            const dateInput = bookingDateEl.value;
            const timeSlot = document.querySelector('input[name="booking-time"]:checked')?.value;
            
            if (!dateInput || !timeSlot) {
                displayAppMessage("請確實選擇預約日期及時間段。");
                bookingSubmitBtn.disabled = false;
                bookingSubmitBtn.textContent = originalText;
                return;
            }
            
            // 檢查該時段是否已被預約（雙重檢查）
            const isBooked = allBookings.some(b => 
                formatDateKey(b.date) === dateInput && b.time === timeSlot
            );
            
            if (isBooked) {
                displayAppMessage("您選擇的時段剛才已被預約，請重新選擇！");
                updateTimeSlots();
                bookingSubmitBtn.disabled = false;
                bookingSubmitBtn.textContent = originalText;
                return;
            }

            // 組裝資料
            const bookingData = {
                name: document.getElementById('booking-name').value.trim(),
                service: document.getElementById('booking-service').value,
                date: new Date(dateInput), // 儲存為 Firestore Timestamp
                time: timeSlot,
                isStudent: document.querySelector('input[name="is-student"]:checked').value,
                isNoshow: document.querySelector('input[name="is-noshow"]:checked').value,
                isModel: document.querySelector('input[name="is-model"]:checked').value,
                createdAt: serverTimestamp()
            };

            try {
                await addDoc(collection(db, BOOKINGS_PATH), bookingData);
                
                displayAppMessage('預約送出成功！請等待 LINE 官方人員確認。', 'success');
                bookingFormEl.reset(); // 重置表單
                updateTimeSlots(); // 刷新時段顯示
            } catch (e) {
                displayAppMessage(`送出預約失敗: ${e.message}`);
            } finally {
                bookingSubmitBtn.disabled = false;
                bookingSubmitBtn.textContent = originalText;
            }
        });

        // --- Initialization ---
        
        // 設定日期選擇器只能選今天或未來
        const todayKey = formatDateKey(new Date());
        bookingDateEl.setAttribute('min', todayKey);


        setupFirebase();

    </script>
</body>
</html>

